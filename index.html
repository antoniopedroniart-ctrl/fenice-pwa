<!doctype html>
<html lang="it"><head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="./icons/icon-192.png">
<link rel="manifest" href="./manifest.json">
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fenice • Home</title>
<style>:root{--bg:#0f1320;--panel:#12182a;--ink:#e9eef7;--ink2:#9bb0d0;--line:#2c3550}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);
font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif}
.topbar{position:sticky;top:0;z-index:40;display:flex;justify-content:space-between;align-items:center;gap:12px;
background:#0b0e19;border-bottom:1px solid var(--line);padding:10px 14px}
.brand{font-weight:700}nav{display:flex;gap:8px;flex-wrap:wrap}
.nav-btn{color:var(--ink);text-decoration:none;border:1px solid var(--line);padding:6px 10px;border-radius:10px}.nav-btn.active{background:#1a2033}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin-bottom:12px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(2,1fr)}@media(max-width:900px){.grid{grid-template-columns:1fr}}
.btn{display:inline-block;margin-top:10px;padding:10px 12px;border:1px solid var(--line);border-radius:10px;text-decoration:none;color:var(--ink);background:#1a2033;cursor:pointer}
.small{color:var(--ink2);font-size:12px}
.table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px solid #222a3d;padding:8px 6px;vertical-align:top}.table th{text-align:left;color:#9bb0d0}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.counter{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:2px 6px;background:#0b0e19}
.counter button{border:0;background:#1a2033;color:var(--ink);border-radius:8px;padding:4px 8px;cursor:pointer}
.counter .val{min-width:22px;text-align:center}
.grid-4{display:grid;gap:10px;grid-template-columns:repeat(4,1fr)}@media(max-width:900px){.grid-4{grid-template-columns:1fr 1fr}}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px;background:#0b0e19;font-size:12px}
.chip .dot{font-size:14px}
.tile{display:flex;justify-content:space-between;align-items:center}
.pills a{display:inline-block;margin:4px 6px 0 0;padding:6px 10px;border:1px solid var(--line);border-radius:999px;text-decoration:none;color:#e9eef7;background:#1a2033;font-size:12px}
.weeknav{display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
.meal{display:flex;gap:8px;align-items:center}
.badge-muscle{font-size:12px;border:1px solid var(--line);border-radius:8px;padding:2px 6px;margin-left:8px;opacity:.9}
hr.sep{border:none;border-top:1px dashed #2c3550;margin:10px 0}</style>

<style>
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:99}
.modal .box{background:#12182a;border:1px solid #2c3550;color:#e9eef7;border-radius:14px;max-width:520px;padding:16px}
.modal .box h3{margin:0 0 8px 0}
.modal .close{float:right;cursor:pointer}
</style>


<style>
.toast-update{position:fixed;left:12px;right:12px;bottom:12px;z-index:100;
  background:#12182a;color:#e9eef7;border:1px solid #2c3550;border-radius:12px;
  padding:12px;display:none;box-shadow:0 8px 24px rgba(0,0,0,.35)}
.toast-update .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.toast-update .msg{font-size:14px}
.toast-update .actions{display:flex;gap:8px}
.toast-update .btn{border:1px solid #2c3550;background:#1a2033;color:#e9eef7;border-radius:10px;padding:6px 10px;cursor:pointer}
</style>

</head><body>
<header class="topbar"><div class="brand">Fenice</div><nav><a class="nav-btn active" href="index.html">🏠 Home</a><a class="nav-btn" href="fenice_diet_training_12w_all_ccapi.html">📅 Piano</a><a class="nav-btn" href="tools.html">⚙️ Strumenti</a><a class="nav-btn" href="fenice_diet_training_12w_all_ccapi.html#calendar">🗓️ Calendari</a><button id="btnInstall" class="nav-btn" style="display:none">⬇️ Installa</button><button id="btnInstallHelp" class="nav-btn" title="Come installo?">❓</button><button id="btnInstallAlways" class="nav-btn">⬇️ Installa</button><a class="nav-btn" href="./study.html">📚 Studio</a></nav></header>
<div class="container">
  <div class="card">
    <h2>📅 Piano 12 settimane (ALL-IN-ONE)</h2>
    <p>Dieta + Allenamento + Galleria esercizi con <b>foto CC</b> e video.</p>
    <a class="btn" href="./fenice_diet_training_12w_all_ccapi.html">Apri il piano</a>
  </div>

  <div class="card">
    <h3>🏋️‍♂️ Overview allenamenti</h3>
    <div class="grid" id="tiles">
      <a class="card tile" href="./fenice_diet_training_12w_all_ccapi.html#train-upper1">
        <div><b>Upper 1</b><div class="small">Petto · Tricipiti</div></div>
        <span class="chip"><span class="dot" id="b-u1">🔵</span><span id="t-u1">–</span></span>
      </a>
      <a class="card tile" href="./fenice_diet_training_12w_all_ccapi.html#train-lower1">
        <div><b>Lower 1</b><div class="small">Quadricipiti · Polpacci</div></div>
        <span class="chip"><span class="dot" id="b-l1">🔵</span><span id="t-l1">–</span></span>
      </a>
      <a class="card tile" href="./fenice_diet_training_12w_all_ccapi.html#train-upper2">
        <div><b>Upper 2</b><div class="small">Spalle · Bicipiti</div></div>
        <span class="chip"><span class="dot" id="b-u2">🔵</span><span id="t-u2">–</span></span>
      </a>
      <a class="card tile" href="./fenice_diet_training_12w_all_ccapi.html#train-lower2">
        <div><b>Lower 2</b><div class="small">Femorali · Glutei</div></div>
        <span class="chip"><span class="dot" id="b-l2">🔵</span><span id="t-l2">–</span></span>
      </a>
    </div>
    <p class="small">Badge: 🟢 Oggi · 🟡 Domani · 🔵 Altri giorni.</p>
  </div>
</div>

<script>
const schedule={{1:null,2:'u1',3:'l1',4:'u2',5:null,6:'l2',0:null}};
const ids={{u1:['b-u1','t-u1'], l1:['b-l1','t-l1'], u2:['b-u2','t-u2'], l2:['b-l2','t-l2']}};
const today=new Date().getDay(), tomorrow=(today+1)%7; const tk=schedule[today], nk=schedule[tomorrow];
function setBadge(key,dot,text){{const a=ids[key]||[];const b=document.getElementById(a[0]),t=document.getElementById(a[1]);if(b&&t){{b.textContent=dot;t.textContent=text;}}}}
if(tk) setBadge(tk,'🟢','Oggi'); if(nk && nk!==tk) setBadge(nk,'🟡','Domani');
['u1','l1','u2','l2'].forEach(k=>{{const t=document.getElementById(ids[k][1]);if(t && t.textContent==='–'){{const dn=['Domenica','Lunedì','Martedì','Mercoledì','Giovedì','Venerdì','Sabato'];const d=Object.keys(schedule).find(x=>schedule[x]===k);if(d!=null)t.textContent=dn[parseInt(d,10)];}}}});
</script>

<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('./service-worker.js')
      .catch(function(e){ console.warn('SW reg failed:', e); });
  });
}
</script>


<script>
// Install prompt handler
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  const b=document.getElementById('btnInstall');
  if(b){ b.style.display='inline-block'; }
});
const bi=document.getElementById('btnInstall');
if(bi){
  bi.addEventListener('click', async ()=>{
    if(!deferredPrompt){ alert('Installazione non disponibile su questo dispositivo/browser.'); return; }
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if(outcome!=='accepted'){ console.log('PWA install declined'); }
    deferredPrompt=null;
    bi.style.display='none';
  });
}
</script>


<script>
(function(){
  function isiOS(){ return /iphone|ipad|ipod/i.test(navigator.userAgent); }
  function isStandalone(){ return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone; }
  function showHelp(){
    let msg = '';
    if(isiOS()){
      msg = 'iOS non mostra il prompt automatico. Vai su Condividi → Aggiungi a Home.';
    } else {
      msg = 'Se non compare il pulsante Installa: assicurati di usare Chrome/Edge, non in anonimo, poi ricarica e riprova. In caso, usa il menu del browser → Aggiungi a schermata Home.';
    }
    alert(msg);
  }
  const hb = document.getElementById('btnInstallHelp');
  if(hb && isStandalone()){ hb.style.display='none'; }
  if(hb){ hb.addEventListener('click', showHelp); }
})();
</script>


<div class="modal" id="installModal"><div class="box">
  <span class="close" id="installClose">✖</span>
  <h3>Installa "Fenice" come app</h3>
  <div id="installSteps" class="small"></div>
  <div style="text-align:right;margin-top:10px"><button class="btn" id="installOk">Ok</button></div>
</div></div>


<script>
(function(){
  let deferredPromptAlways=null;
  window.addEventListener('beforeinstallprompt',(e)=>{
    e.preventDefault();
    deferredPromptAlways = e;
  });

  function isiOS(){ return /iphone|ipad|ipod/i.test(navigator.userAgent); }
  function isStandalone(){ return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone; }

  function openModal(stepsHtml){
    const m = document.getElementById('installModal'); const s = document.getElementById('installSteps');
    if(!m || !s) return;
    s.innerHTML = stepsHtml;
    m.style.display='flex';
  }
  function closeModal(){
    const m = document.getElementById('installModal');
    if(m) m.style.display='none';
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const btn = document.getElementById('btnInstallAlways');
    const close = document.getElementById('installClose');
    const ok = document.getElementById('installOk');
    if(close) close.addEventListener('click', closeModal);
    if(ok) ok.addEventListener('click', closeModal);
    if(btn){
      btn.addEventListener('click', async ()=>{
        if(isStandalone()){ alert('Fenice è già installata.'); return; }
        if(deferredPromptAlways){
          deferredPromptAlways.prompt();
          const res = await deferredPromptAlways.userChoice;
          deferredPromptAlways = null;
          if(res && res.outcome==='accepted'){ return; }
        }
        // Fallback instructions
        if(isiOS()){
          openModal("<ol><li>Apri in Safari.</li><li>Tocca <b>Condividi</b> (icona ⬆️)</li><li>Seleziona <b>Aggiungi a Home</b>.</li></ol>");
        }else{
          openModal("<ol><li>Apri il menu del browser (⋮).</li><li>Tocca <b>Aggiungi a schermata Home</b>.</li><li>Conferma e apri l’app.</li></ol>");
        }
      });
    }
    window.addEventListener('appinstalled', ()=>{ alert('Installazione completata!'); });
  });
})();
</script>


<div class="toast-update" id="toastUpdate">
  <div class="row">
    <div class="msg">È disponibile un aggiornamento di <b>Fenice</b>.</div>
    <div class="actions">
      <button class="btn" id="btnUpdNow">Aggiorna ora</button>
      <button class="btn" id="btnUpdLater">Più tardi</button>
    </div>
  </div>
</div>


<script>
(function(){
  // SW update detection: show toast when a new worker is waiting
  let newWorker = null;
  function showToast(){ const t=document.getElementById('toastUpdate'); if(t) t.style.display='block'; }
  function hideToast(){ const t=document.getElementById('toastUpdate'); if(t) t.style.display='none'; }
  function refreshPage(){ if(newWorker){ newWorker.postMessage({type:'SKIP_WAITING'}); } setTimeout(()=>location.reload(true), 300); }

  if('serviceWorker' in navigator){
    navigator.serviceWorker.getRegistration().then(reg=>{
      if(!reg) return;
      // Already waiting?
      if(reg.waiting){ newWorker = reg.waiting; showToast(); }
      reg.addEventListener('updatefound', ()=>{
        const installing = reg.installing;
        if(!installing) return;
        installing.addEventListener('statechange', ()=>{
          if(installing.state === 'installed' && navigator.serviceWorker.controller){
            newWorker = reg.waiting;
            showToast();
          }
        });
      });
    });
    // Listen for controllerchange (after skipWaiting)
    navigator.serviceWorker.addEventListener('controllerchange', ()=>{ hideToast(); });
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const now=document.getElementById('btnUpdNow');
    const later=document.getElementById('btnUpdLater');
    if(now) now.addEventListener('click', refreshPage);
    if(later) later.addEventListener('click', hideToast);
  });
})();
</script>

</body></html>

<script>
(function(){
  const schedule = {1:null,2:'u1',3:'l1',4:'u2',5:null,6:'l2',0:null};
  const ids = {u1:['b-u1','t-u1'], l1:['b-l1','t-l1'], u2:['b-u2','t-u2'], l2:['b-l2','t-l2']};
  function dn(i){return ['Domenica','Lunedì','Martedì','Mercoledì','Giovedì','Venerdì','Sabato'][i]}
  function fmt(d){const z=n=>String(n).padStart(2,'0'); return z(d.getDate())+'/'+z(d.getMonth()+1)}
  function labelForKey(k, baseDate){
    // Find weekday index that maps to key (this week's plan)
    const wd = Object.keys(schedule).find(x=>schedule[x]===k); if(wd==null) return '—';
    // compute date of this week's wd relative to today
    const today = new Date(baseDate); const diff = ( (parseInt(wd,10) - today.getDay()) + 7 ) % 7;
    const dt = new Date(today); dt.setDate(today.getDate()+diff);
    return dn(parseInt(wd,10)) + ' ' + fmt(dt);
  }
  function apply(){
    const now = new Date();
    const today = now.getDay(), tomorrow = (today+1)%7;
    const tk = schedule[today], nk = schedule[tomorrow];
    function setBadge(key, dot, text){
      const a = ids[key]||[]; const b=document.getElementById(a[0]), t=document.getElementById(a[1]);
      if(b&&t){ b.textContent = dot; t.textContent = text; }
    }
    // default labels with weekday+date
    Object.keys(ids).forEach(k=>{
      const t = document.getElementById(ids[k][1]);
      if(t){ t.textContent = labelForKey(k, now); }
    });
    if(tk) setBadge(tk,'🟢','Oggi'); 
    if(nk && nk!==tk) setBadge(nk,'🟡','Domani');
  }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', apply); } else { apply(); }
})();
</script>

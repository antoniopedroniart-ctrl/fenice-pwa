<!doctype html>
<html lang="it"><head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="./icons/icon-192.png">
<link rel="manifest" href="./manifest.json">
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fenice ‚Ä¢ Strumenti</title>
<style>:root{--bg:#0f1320;--panel:#12182a;--ink:#e9eef7;--ink2:#9bb0d0;--line:#2c3550}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);
font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif}
.topbar{position:sticky;top:0;z-index:40;display:flex;justify-content:space-between;align-items:center;gap:12px;
background:#0b0e19;border-bottom:1px solid var(--line);padding:10px 14px}
.brand{font-weight:700}nav{display:flex;gap:8px;flex-wrap:wrap}
.nav-btn{color:var(--ink);text-decoration:none;border:1px solid var(--line);padding:6px 10px;border-radius:10px}.nav-btn.active{background:#1a2033}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin-bottom:12px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(2,1fr)}@media(max-width:900px){.grid{grid-template-columns:1fr}}
.btn{display:inline-block;margin-top:10px;padding:10px 12px;border:1px solid var(--line);border-radius:10px;text-decoration:none;color:var(--ink);background:#1a2033;cursor:pointer}
.small{color:var(--ink2);font-size:12px}
.table{width:100%;border-collapse:collapse}.table th,.table td{border-bottom:1px solid #222a3d;padding:8px 6px;vertical-align:top}.table th{text-align:left;color:#9bb0d0}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.counter{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:2px 6px;background:#0b0e19}
.counter button{border:0;background:#1a2033;color:var(--ink);border-radius:8px;padding:4px 8px;cursor:pointer}
.counter .val{min-width:22px;text-align:center}
.grid-4{display:grid;gap:10px;grid-template-columns:repeat(4,1fr)}@media(max-width:900px){.grid-4{grid-template-columns:1fr 1fr}}
.chip{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px;background:#0b0e19;font-size:12px}
.chip .dot{font-size:14px}
.tile{display:flex;justify-content:space-between;align-items:center}
.pills a{display:inline-block;margin:4px 6px 0 0;padding:6px 10px;border:1px solid var(--line);border-radius:999px;text-decoration:none;color:#e9eef7;background:#1a2033;font-size:12px}
.weeknav{display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
.meal{display:flex;gap:8px;align-items:center}
.badge-muscle{font-size:12px;border:1px solid var(--line);border-radius:8px;padding:2px 6px;margin-left:8px;opacity:.9}
hr.sep{border:none;border-top:1px dashed #2c3550;margin:10px 0} #t{font-size:42px;margin:12px}button.btn{cursor:pointer}</style>

<style>
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:99}
.modal .box{background:#12182a;border:1px solid #2c3550;color:#e9eef7;border-radius:14px;max-width:520px;padding:16px}
.modal .box h3{margin:0 0 8px 0}
.modal .close{float:right;cursor:pointer}
</style>


<style>
.toast-update{position:fixed;left:12px;right:12px;bottom:12px;z-index:100;
  background:#12182a;color:#e9eef7;border:1px solid #2c3550;border-radius:12px;
  padding:12px;display:none;box-shadow:0 8px 24px rgba(0,0,0,.35)}
.toast-update .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.toast-update .msg{font-size:14px}
.toast-update .actions{display:flex;gap:8px}
.toast-update .btn{border:1px solid #2c3550;background:#1a2033;color:#e9eef7;border-radius:10px;padding:6px 10px;cursor:pointer}
</style>

</head><body>
<header class="topbar"><div class="brand">Fenice</div><nav><a class="nav-btn" href="index.html">üè† Home</a><a class="nav-btn" href="fenice_diet_training_12w_all_ccapi.html">üìÖ Piano</a><a class="nav-btn active" href="tools.html">‚öôÔ∏è Strumenti</a><a class="nav-btn" href="fenice_diet_training_12w_all_ccapi.html#calendar">üóìÔ∏è Calendari</a><button id="btnInstall" class="nav-btn" style="display:none">‚¨áÔ∏è Installa</button><button id="btnInstallHelp" class="nav-btn" title="Come installo?">‚ùì</button><button id="btnInstallAlways" class="nav-btn">‚¨áÔ∏è Installa</button></nav></header>
<div class="container">
  <div class="card"><h2>Timer</h2>
    <div class="row">
      <button class="btn" onclick="start(50*60)">Studio 50'</button>
      <button class="btn" onclick="start(10*60)">Pausa 10'</button>
      <button class="btn" onclick="start(90*60)">Allenamento 90'</button>
      <button class="btn" onclick="start(5*60)">Rest 5'</button>
    </div>
    <div id="t">00:00</div>
  </div>
</div>
<script>
let intv=0,remain=0;
function fmt(s){const m=String(Math.floor(s/60)).padStart(2,'0');const ss=String(s%60).padStart(2,'0');return m+':'+ss}
function tick(){remain--;document.getElementById('t').textContent=fmt(remain);if(remain<=0){clearInterval(intv);}}
function start(sec){clearInterval(intv);remain=sec;document.getElementById('t').textContent=fmt(remain);intv=setInterval(tick,1000)}
</script>

<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('./service-worker.js')
      .catch(function(e){ console.warn('SW reg failed:', e); });
  });
}
</script>


<script>
// Install prompt handler
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',(e)=>{
  e.preventDefault();
  deferredPrompt=e;
  const b=document.getElementById('btnInstall');
  if(b){ b.style.display='inline-block'; }
});
const bi=document.getElementById('btnInstall');
if(bi){
  bi.addEventListener('click', async ()=>{
    if(!deferredPrompt){ alert('Installazione non disponibile su questo dispositivo/browser.'); return; }
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if(outcome!=='accepted'){ console.log('PWA install declined'); }
    deferredPrompt=null;
    bi.style.display='none';
  });
}
</script>


<script>
(function(){
  function isiOS(){ return /iphone|ipad|ipod/i.test(navigator.userAgent); }
  function isStandalone(){ return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone; }
  function showHelp(){
    let msg = '';
    if(isiOS()){
      msg = 'iOS non mostra il prompt automatico. Vai su Condividi ‚Üí Aggiungi a Home.';
    } else {
      msg = 'Se non compare il pulsante Installa: assicurati di usare Chrome/Edge, non in anonimo, poi ricarica e riprova. In caso, usa il menu del browser ‚Üí Aggiungi a schermata Home.';
    }
    alert(msg);
  }
  const hb = document.getElementById('btnInstallHelp');
  if(hb && isStandalone()){ hb.style.display='none'; }
  if(hb){ hb.addEventListener('click', showHelp); }
})();
</script>


<div class="modal" id="installModal"><div class="box">
  <span class="close" id="installClose">‚úñ</span>
  <h3>Installa "Fenice" come app</h3>
  <div id="installSteps" class="small"></div>
  <div style="text-align:right;margin-top:10px"><button class="btn" id="installOk">Ok</button></div>
</div></div>


<script>
(function(){
  let deferredPromptAlways=null;
  window.addEventListener('beforeinstallprompt',(e)=>{
    e.preventDefault();
    deferredPromptAlways = e;
  });

  function isiOS(){ return /iphone|ipad|ipod/i.test(navigator.userAgent); }
  function isStandalone(){ return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone; }

  function openModal(stepsHtml){
    const m = document.getElementById('installModal'); const s = document.getElementById('installSteps');
    if(!m || !s) return;
    s.innerHTML = stepsHtml;
    m.style.display='flex';
  }
  function closeModal(){
    const m = document.getElementById('installModal');
    if(m) m.style.display='none';
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const btn = document.getElementById('btnInstallAlways');
    const close = document.getElementById('installClose');
    const ok = document.getElementById('installOk');
    if(close) close.addEventListener('click', closeModal);
    if(ok) ok.addEventListener('click', closeModal);
    if(btn){
      btn.addEventListener('click', async ()=>{
        if(isStandalone()){ alert('Fenice √® gi√† installata.'); return; }
        if(deferredPromptAlways){
          deferredPromptAlways.prompt();
          const res = await deferredPromptAlways.userChoice;
          deferredPromptAlways = null;
          if(res && res.outcome==='accepted'){ return; }
        }
        // Fallback instructions
        if(isiOS()){
          openModal("<ol><li>Apri in Safari.</li><li>Tocca <b>Condividi</b> (icona ‚¨ÜÔ∏è)</li><li>Seleziona <b>Aggiungi a Home</b>.</li></ol>");
        }else{
          openModal("<ol><li>Apri il menu del browser (‚ãÆ).</li><li>Tocca <b>Aggiungi a schermata Home</b>.</li><li>Conferma e apri l‚Äôapp.</li></ol>");
        }
      });
    }
    window.addEventListener('appinstalled', ()=>{ alert('Installazione completata!'); });
  });
})();
</script>


<div class="toast-update" id="toastUpdate">
  <div class="row">
    <div class="msg">√à disponibile un aggiornamento di <b>Fenice</b>.</div>
    <div class="actions">
      <button class="btn" id="btnUpdNow">Aggiorna ora</button>
      <button class="btn" id="btnUpdLater">Pi√π tardi</button>
    </div>
  </div>
</div>


<script>
(function(){
  // SW update detection: show toast when a new worker is waiting
  let newWorker = null;
  function showToast(){ const t=document.getElementById('toastUpdate'); if(t) t.style.display='block'; }
  function hideToast(){ const t=document.getElementById('toastUpdate'); if(t) t.style.display='none'; }
  function refreshPage(){ if(newWorker){ newWorker.postMessage({type:'SKIP_WAITING'}); } setTimeout(()=>location.reload(true), 300); }

  if('serviceWorker' in navigator){
    navigator.serviceWorker.getRegistration().then(reg=>{
      if(!reg) return;
      // Already waiting?
      if(reg.waiting){ newWorker = reg.waiting; showToast(); }
      reg.addEventListener('updatefound', ()=>{
        const installing = reg.installing;
        if(!installing) return;
        installing.addEventListener('statechange', ()=>{
          if(installing.state === 'installed' && navigator.serviceWorker.controller){
            newWorker = reg.waiting;
            showToast();
          }
        });
      });
    });
    // Listen for controllerchange (after skipWaiting)
    navigator.serviceWorker.addEventListener('controllerchange', ()=>{ hideToast(); });
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    const now=document.getElementById('btnUpdNow');
    const later=document.getElementById('btnUpdLater');
    if(now) now.addEventListener('click', refreshPage);
    if(later) later.addEventListener('click', hideToast);
  });
})();
</script>

</body></html>
